<!doctype html>
<html>
<head>
<style>
html, body {
	height:100%;
	width:100%;
}
body {
	padding:0;
	margin:0;
}
.cursor {
	position	:absolute;
	width		:20px;
	height		:20px;
	background	:#F00;  
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script src="../easyWebSocket.js"></script>
<script>
jQuery(function() {

var socket	= new EasyWebSocket("ws://cursors/movingDDD");
var me		= Math.floor(Math.random() * 1000000).toString(32)
var cursors	= {}

socket.onopen	= function() {
	binds()
}

socket.onmessage = function(event) {
	var data = event.data.split(' ')
	if (data[0] != me) return
	console.log(event)  
	if (typeof cursors[data[0]] === 'undefined') {
		cursors[data[0]] = jQuery('<div/>').attr('id', data[0]).addClass('cursor').appendTo('body')
	}
	cursors[data[0]].css({ left: data[1] + 'px', top: data[2] + 'px' })
}

var then = +new Date()
  , throttle = function(t, f) {
  if (+new Date() - then > t) {
    then = +new Date()
    f()
  } else delete f
}

var binds = function() {
	$('body').bind('mousemove', function(e) {
		throttle(1000/10, function() {
			socket.send(me + ' ' + e.pageX + ' ' + e.pageY)
		})
	})
}

})
</script>

</head>
<body>
</body>
</html>
