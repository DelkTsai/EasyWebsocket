WebsocketAnywhere=function(a){var b=this;this.url=a;this.resource=this.url.match(/.*:\/\/[^/]*\/(.+)/)[1];this.iframeOrigin="http://localhost:8080";this.iframeUrl=this.iframeOrigin+"/static/iframe.html";this._iframeCtor();this.onopen=function(){console.log("default onopen")};this.onmessage=function(){console.log("default onmessage")};this.onerror=function(){console.log("default onerror")};this.onclose=function(){console.log("default onclose")};window.addEventListener("message",function(c){c.origin==
b.iframeOrigin&&b._onWindowMessage(c)},false)};WebsocketAnywhere.prototype._onWindowMessage=function(a){a=JSON.parse(a.data);var b=a.type,c=a.data;console.log("recevied message from iframe",a);if(b=="connected")this.onopen();else b=="data"&&this.onmessage({data:c})};WebsocketAnywhere.prototype.send=function(a){this._iframeSendData(a)};WebsocketAnywhere.prototype.close=function(){this._iframeDtor()};
WebsocketAnywhere.prototype._iframeCtor=function(){var a=this;this.iframeId="WebsocketAnywhere-iframe-"+Math.floor(Math.random()*99999);var b=document.createElement("iframe");b.src=this.iframeUrl;b.id=this.iframeId;b.style.position="absolute";b.style.visibility="hidden";b.style.top=b.style.left="0";b.style.width=b.style.height="0";b.onload=function(){console.log("iframe loaded");a._iframeSendConnect()};document.getElementsByTagName("body")[0].appendChild(b)};
WebsocketAnywhere.prototype._iframeDtor=function(){var a=document.getElementById(this.iframeId);a.parent.removeChild(a)};WebsocketAnywhere.prototype._iframeExist=function(){return this.iframeId};WebsocketAnywhere.prototype._iframeSendRaw=function(a){console.log("iframeSendRaw(",a,")");document.getElementById(this.iframeId).contentWindow.postMessage(JSON.stringify(a),"*")};WebsocketAnywhere.prototype._iframeSendConnect=function(){this._iframeSendRaw({type:"connect",data:{resource:this.resource}})};
WebsocketAnywhere.prototype._iframeSendData=function(a){this._iframeSendRaw({type:"data",data:{message:a}})};WebsocketAnywhere.STATE={};WebsocketAnywhere.STATE.CONNECTING=0;WebsocketAnywhere.STATE.OPEN=1;WebsocketAnywhere.STATE.CLOSING=2;WebsocketAnywhere.STATE.CLOSED=3;
